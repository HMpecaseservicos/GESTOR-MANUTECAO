{% extends "base.html" %}

{% block title %}Fornecedores{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-6">Gestão de Fornecedores</h1>
        <p class="text-muted">Gerencie sua rede de fornecedores e parceiros</p>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-4">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#novoFornecedorModal">
            <i class="fas fa-plus"></i> Novo Fornecedor
        </button>
    </div>
    <div class="col-md-8">
        <div class="input-group">
            <input type="text" class="form-control" placeholder="Buscar por nome..." id="searchFornecedores">
            <select class="form-select" style="max-width: 220px;" id="filterEspecialidade">
                <option value="">Todas especialidades</option>
                <option value="peças">Peças</option>
                <option value="serviços mecânicos">Serviços</option>
                <option value="pneus">Pneus</option>
                <option value="combustível">Combustível</option>
                <option value="elétrica">Elétrica</option>
                <option value="pintura">Pintura/Funilaria</option>
                <option value="vidros">Vidros</option>
            </select>
            <button class="btn btn-outline-primary" type="button" id="btnBuscar">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
</div>

<div class="row" id="listaFornecedores">
    {% for fornecedor in fornecedores %}
    <div class="col-md-6 col-lg-4 mb-4 fornecedor-card" data-nome="{{ fornecedor[1] }}" data-especialidade="{{ fornecedor[5] or '' }}">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0">
                    <i class="fas fa-building"></i> {{ fornecedor[1] }}
                </h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <strong><i class="fas fa-user"></i> Contato:</strong><br>
                    <span class="text-muted">{{ fornecedor[2] or 'Não informado' }}</span>
                </div>
                
                <div class="mb-2">
                    <strong><i class="fas fa-phone"></i> Telefone:</strong><br>
                    <span class="text-muted">{{ fornecedor[3] or 'Não informado' }}</span>
                </div>
                
                <div class="mb-2">
                    <strong><i class="fas fa-envelope"></i> Email:</strong><br>
                    <span class="text-muted">{{ fornecedor[4] or 'Não informado' }}</span>
                </div>
                
                <div class="mb-3">
                    <strong><i class="fas fa-tags"></i> Especialidade:</strong><br>
                    <span class="badge bg-info">{{ fornecedor[5] or 'Geral' }}</span>
                </div>
            </div>
            <div class="card-footer">
                <div class="btn-group w-100" role="group">
                    <button class="btn btn-sm btn-outline-primary btn-detalhes" data-id="{{ fornecedor[0] }}" title="Ver Detalhes">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success btn-whatsapp" data-telefone="{{ fornecedor[3] or '' }}" data-nome="{{ fornecedor[1] }}" title="WhatsApp">
                        <i class="fab fa-whatsapp"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-warning btn-editar" data-id="{{ fornecedor[0] }}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger btn-excluir" data-id="{{ fornecedor[0] }}" data-nome="{{ fornecedor[1] }}" title="Excluir">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Estatísticas -->
<div class="row mt-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body text-center">
                <i class="fas fa-building fa-2x mb-2"></i>
                <h5>Total de Fornecedores</h5>
                <h3>{{ fornecedores|length }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body text-center">
                <i class="fas fa-cogs fa-2x mb-2"></i>
                <h5>Peças</h5>
                <h3>
                    {% set count = 0 %}
                    {% for fornecedor in fornecedores %}
                        {% if fornecedor[5] and 'peças' in fornecedor[5].lower() %}
                            {% set count = count + 1 %}
                        {% endif %}
                    {% endfor %}
                    {{ count }}
                </h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-info">
            <div class="card-body text-center">
                <i class="fas fa-wrench fa-2x mb-2"></i>
                <h5>Serviços</h5>
                <h3>
                    {% set count = 0 %}
                    {% for fornecedor in fornecedores %}
                        {% if fornecedor[5] and 'mecânic' in fornecedor[5].lower() %}
                            {% set count = count + 1 %}
                        {% endif %}
                    {% endfor %}
                    {{ count }}
                </h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body text-center">
                <i class="fas fa-circle fa-2x mb-2"></i>
                <h5>Pneus</h5>
                <h3>
                    {% set count = 0 %}
                    {% for fornecedor in fornecedores %}
                        {% if fornecedor[5] and 'pneu' in fornecedor[5].lower() %}
                            {% set count = count + 1 %}
                        {% endif %}
                    {% endfor %}
                    {{ count }}
                </h3>
            </div>
        </div>
    </div>
</div>

<!-- Modal Novo Fornecedor -->
<div class="modal fade" id="novoFornecedorModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-plus"></i> Novo Fornecedor</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="novoFornecedorForm" autocomplete="off" novalidate onsubmit="return false;">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nome da Empresa <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="nome" id="inputNomeFornecedor" autocomplete="off" autofocus>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Pessoa de Contato</label>
                            <input type="text" class="form-control" name="contato" autocomplete="off">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Telefone</label>
                            <input type="tel" class="form-control" name="telefone" placeholder="(11) 9999-8888" autocomplete="off">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" autocomplete="off">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Especialidade</label>
                        <select class="form-select" name="especialidade">
                            <option value="">Selecione a especialidade</option>
                            <option value="Peças para caminhões">Peças para caminhões</option>
                            <option value="Peças para máquinas">Peças para máquinas</option>
                            <option value="Serviços mecânicos">Serviços mecânicos</option>
                            <option value="Pneus e rodas">Pneus e rodas</option>
                            <option value="Combustível e lubrificantes">Combustível e lubrificantes</option>
                            <option value="Elétrica e eletrônica">Elétrica e eletrônica</option>
                            <option value="Pintura e funilaria">Pintura e funilaria</option>
                            <option value="Vidros e acessórios">Vidros e acessórios</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">CNPJ</label>
                            <input type="text" class="form-control" name="cnpj" placeholder="00.000.000/0000-00">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Endereço</label>
                            <input type="text" class="form-control" name="endereco" placeholder="Rua, número, cidade">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnSalvarFornecedor">
                    <i class="fas fa-save"></i> Salvar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Detalhes do Fornecedor -->
<div class="modal fade" id="detalhesFornecedorModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-info-circle"></i> Detalhes do Fornecedor</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <strong><i class="fas fa-building"></i> Nome da Empresa:</strong>
                        <p class="text-muted" id="detalhe-nome">-</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong><i class="fas fa-user"></i> Pessoa de Contato:</strong>
                        <p class="text-muted" id="detalhe-contato">-</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <strong><i class="fas fa-phone"></i> Telefone:</strong>
                        <p class="text-muted" id="detalhe-telefone">-</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong><i class="fas fa-envelope"></i> Email:</strong>
                        <p class="text-muted" id="detalhe-email">-</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <strong><i class="fas fa-tags"></i> Especialidade:</strong>
                        <p class="text-muted" id="detalhe-especialidade">-</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong><i class="fas fa-id-card"></i> CNPJ:</strong>
                        <p class="text-muted" id="detalhe-cnpj">-</p>
                    </div>
                </div>
                <div class="mb-3">
                    <strong><i class="fas fa-map-marker-alt"></i> Endereço:</strong>
                    <p class="text-muted" id="detalhe-endereco">-</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <button type="button" class="btn btn-success" onclick="contatarWhatsAppDetalhes()">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Editar Fornecedor -->
<div class="modal fade" id="editarFornecedorModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title"><i class="fas fa-edit"></i> Editar Fornecedor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editarFornecedorForm">
                    <input type="hidden" id="edit-id">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nome da Empresa <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="edit-nome" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Pessoa de Contato</label>
                            <input type="text" class="form-control" id="edit-contato">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Telefone</label>
                            <input type="tel" class="form-control" id="edit-telefone" placeholder="(11) 9999-8888">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="edit-email">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Especialidade</label>
                        <select class="form-select" id="edit-especialidade">
                            <option value="">Selecione a especialidade</option>
                            <option value="Peças para caminhões">Peças para caminhões</option>
                            <option value="Peças para máquinas">Peças para máquinas</option>
                            <option value="Serviços mecânicos">Serviços mecânicos</option>
                            <option value="Pneus e rodas">Pneus e rodas</option>
                            <option value="Combustível e lubrificantes">Combustível e lubrificantes</option>
                            <option value="Elétrica e eletrônica">Elétrica e eletrônica</option>
                            <option value="Pintura e funilaria">Pintura e funilaria</option>
                            <option value="Vidros e acessórios">Vidros e acessórios</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">CNPJ</label>
                            <input type="text" class="form-control" id="edit-cnpj" placeholder="00.000.000/0000-00">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Endereço</label>
                            <input type="text" class="form-control" id="edit-endereco" placeholder="Rua, número, cidade">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-warning" onclick="salvarEdicaoFornecedor()">
                    <i class="fas fa-save"></i> Salvar Alterações
                </button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/fornecedores.js') }}"></script>

{% endblock %}